@*
 * Copyright 2021 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import utils.CurrencyFormatter.currencyFormat
@import models.financialdata.VatReturnWithFinancialData

@this(
        layout: templates.Layout
)

@(vatReturnsWithFinancialData: List[VatReturnWithFinancialData], displayBanner: Boolean)(implicit request: Request[_], messages: Messages)

@layout(pageTitle = titleNoForm(messages("submittedReturnsHistory.title")), showBackLink = false) {

    <div class="govuk-breadcrumbs" style="margin-bottom:50px;">
        <ol class="govuk-breadcrumbs__list">
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="@routes.YourAccountController.onPageLoad()" id="your-account">@messages("breadcrumbs.yourAccount")</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">@messages("breadcrumbs.submittedReturns")</li>
        </ol>
    </div>

    @if(displayBanner) {
        <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
            <div class="govuk-notification-banner__header">
                <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                @messages("notificationBanner.title")
                </h2>
            </div>
            <div class="govuk-notification-banner__content">
                <p class="govuk-notification-banner__heading">
                @messages("notificationBanner.text")
                </p>
            </div>
        </div>
    }

    <h1 class="govuk-heading-xl">@messages("submittedReturnsHistory.heading")</h1>

    @vatReturnsWithFinancialData.size match {
        case 0 => {
            <p class="govuk-body-m">@messages("submittedReturnsHistory.no-returns")</p>
        }
        case _ => {
            <table class="govuk-table">
                <caption class="govuk-table__caption govuk-table__caption--m">2021</caption>
                <thead class="govuk-table__head">
                    <tr class="govuk-table__row">
                        <th scope="col" class="govuk-table__header">Return period</th>
                        @if(vatReturnsWithFinancialData.exists(_.charge.isDefined)) {
                            <th scope="col" class="govuk-table__header">Amount left to pay</th>
                        }
                        @if(vatReturnsWithFinancialData.exists(_.vatOwed.isDefined) && (vatReturnsWithFinancialData.exists(_.charge.isDefined) || vatReturnsWithFinancialData.exists(_.charge.exists(_.outstandingAmount > 0)))) {
                            <th scope="col" class="govuk-table__header"></th>
                        }
                    </tr>
                </thead>
                <tbody class="govuk-table__body">
                    @for(vatReturnWithFinancialData <- vatReturnsWithFinancialData) {
                        @vatReturnWithFinancialData.vatReturn match {
                            case Some(vatReturn) => {

                                <tr class="govuk-table__row">
                                    <th scope="row" class="govuk-table__header">
                                        <a class="govuk-link govuk-body" href="@routes.PreviousReturnController.onPageLoad(vatReturn.period)" id="period">@vatReturn.period.displayText</a>
                                    </th>
                                    <td class="govuk-table__cell">
                                        @if(vatReturnWithFinancialData.charge.isDefined) {
                                            @vatReturnWithFinancialData.charge.map(c => Html(currencyFormat(c.outstandingAmount)))
                                        }
                                    </td>
                                    <td class="govuk-table__cell">
                                        @if(vatReturnWithFinancialData.vatOwed.isDefined && (vatReturnWithFinancialData.charge.isEmpty || vatReturnWithFinancialData.charge.exists(c => c.outstandingAmount > 0))) {
                                            <a href="@routes.PaymentController.makePayment(vatReturn.period, vatReturnWithFinancialData.vatOwed.get)">@messages("returnSubmitted.payNow")</a>
                                        }
                                    </td>
                                </tr>
                            }
                            case _ => {}
                        }
                    }
                </tbody>
            </table>
        }
    }


}
