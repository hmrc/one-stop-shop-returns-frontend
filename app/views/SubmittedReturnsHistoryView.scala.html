@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import utils.CurrencyFormatter.currencyFormat
@import models.financialdata.VatReturnWithFinancialData
@import models.PaymentState._

@this(
        layout: templates.Layout
)

@(vatReturnsWithFinancialData: Seq[VatReturnWithFinancialData], displayBanner: Boolean)(implicit request: Request[_], messages: Messages)

@layout(pageTitle = titleNoForm(messages("submittedReturnsHistory.title")), showBackLink = false) {

    <div class="govuk-breadcrumbs" style="margin-bottom:50px;">
        <ol class="govuk-breadcrumbs__list">
            <li class="govuk-breadcrumbs__list-item">
                <a class="govuk-breadcrumbs__link" href="@routes.YourAccountController.onPageLoad()" id="your-account">@messages("breadcrumbs.yourAccount")</a>
            </li>
            <li class="govuk-breadcrumbs__list-item">@messages("breadcrumbs.submittedReturns")</li>
        </ol>
    </div>

    @if(displayBanner) {
        <div class="govuk-notification-banner" role="region" aria-labelledby="govuk-notification-banner-title" data-module="govuk-notification-banner">
            <div class="govuk-notification-banner__header">
                <h2 class="govuk-notification-banner__title" id="govuk-notification-banner-title">
                @messages("notificationBanner.title")
                </h2>
            </div>
            <div class="govuk-notification-banner__content">
                <p class="govuk-notification-banner__heading">
                @messages("notificationBanner.text")
                </p>
            </div>
        </div>
    }

    <h1 class="govuk-heading-xl" style="margin-bottom:0px;">@messages("submittedReturnsHistory.heading")</h1>

    <p class="govuk-caption-m hmrc-caption-m" style="margin-bottom:50px;">
        @messages("submittedReturnsHistory.caption")
    </p>

    @vatReturnsWithFinancialData.size match {
        case 0 => {
            <p class="govuk-body-m">@messages("submittedReturnsHistory.no-returns")</p>
        }
        case _ => {
            @vatReturnsWithFinancialData.groupBy(_.vatReturn.period.year).map {
                case (year, vatReturnsWithFinancialData) => {
                    <table class="govuk-table">
                        <caption class="govuk-table__caption govuk-table__caption--m">@year.toString</caption>
                        <thead class="govuk-table__head">
                            <tr class="govuk-table__row">
                                <th scope="col" class="govuk-table__header return-period-column">@messages("submittedReturnsHistory.returnPeriod")</th>
                                <th scope="col" class="govuk-table__header amount-left-column">@messages("submittedReturnsHistory.amountLeftToPay")</th>
                                <th scope="col" class="govuk-table__header payment-column">@messages("submittedReturnsHistory.payment")</th>
                            </tr>
                        </thead>
                        <tbody class="govuk-table__body">
                        @for(vatReturnWithFinancialData <- vatReturnsWithFinancialData) {
                            <tr class="govuk-table__row">
                                <th scope="row" class="govuk-table__header">
                                    <a class="govuk-link govuk-body" href="@routes.PreviousReturnController.onPageLoad(vatReturnWithFinancialData.vatReturn.period)" id="period">@vatReturnWithFinancialData.vatReturn.period.displayText</a>
                                </th>
                                <td class="govuk-table__cell">
                                @if(vatReturnWithFinancialData.showUpdating) {
                                    @messages("submittedReturnsHistory.updating")
                                } else {
                                    @vatReturnWithFinancialData.charge.map(c => Html(currencyFormat(c.outstandingAmount))).getOrElse(Html(currencyFormat(0L)))
                                }
                                </td>
                                <td class="govuk-table__cell">
                                @if(vatReturnWithFinancialData.paymentState == PaymentDue) {
                                    <a class="govuk-link" href="@routes.PaymentController.makePayment(vatReturnWithFinancialData.vatReturn.period, (vatReturnWithFinancialData.vatOwed * 100).toLong)">@messages(vatReturnWithFinancialData.paymentState.toString)</a>
                                } else {
                                    @messages(vatReturnWithFinancialData.paymentState.toString)
                                }
                                </td>
                            </tr>
                        }
                        </tbody>
                    </table>
                }
                case _ => {}
            }

        }
    }


}
